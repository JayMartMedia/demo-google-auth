(()=>{let e,o,t,n;const s="http://localhost:4401";function a(e){const o=e.split("."),t=atob(o[1]);return JSON.parse(t)}function r(){u("auth-show-logged-in"),c("auth-show-logged-out")}function i(){c("auth-show-logged-in"),u("auth-show-logged-out")}function c(e){for(elem of document.getElementsByClassName(e))elem.classList.add("auth-hide")}function u(e){for(elem of document.getElementsByClassName(e))elem.classList.remove("auth-hide")}function l(){return t||sessionStorage.getItem("accessToken")}function d(e){t=e,sessionStorage.setItem("accessToken",e);const{exp:o}=a(e);n=o,sessionStorage.setItem("accessTokenExpiry",o)}function h(){return e||sessionStorage.getItem("refreshToken")}function m(){return o||sessionStorage.getItem("refreshTokenExpiry")}function g(t){e=t,sessionStorage.setItem("refreshToken",t);const{exp:n}=a(t);o=n,sessionStorage.setItem("refreshTokenExpiry",n)}async function f(){h()&&(n||sessionStorage.getItem("accessTokenExpiry"))<Math.floor(Date.now()/1e3)&&(m()<Math.floor(Date.now()/1e3)&&(k(),1)||await async function(){const e=await fetch(`${s}/refresh`,{method:"POST",body:JSON.stringify({refreshToken:h()}),headers:new Headers({"Content-Type":"application/json"})}),{accessToken:o,refreshToken:t}=await e.json();g(t),d(o)}())}function p(e){const o=a(e),t={userId:o.userId,email:o.email,name:o.name,picture:o.picture},n=new CustomEvent("logged-in",{detail:{userInfo:t}});document.dispatchEvent(n)}async function w(e){const o=e.credential,t=await fetch(`${s}/token`,{method:"POST",body:JSON.stringify({googleJwt:o}),headers:new Headers({"Content-Type":"application/json"})}),{accessToken:n,refreshToken:i}=await t.json();g(i),d(n),p(n),r();const{userId:c,picture:u,name:l,email:h}=a(n);var m;m={userId:c,picture:u,name:l,email:h},window.auth.userInfo=m}function T(){google.accounts.id.initialize({client_id:"403706356522-9l5kmo3oujjk8ho182ec3kts8k96d935.apps.googleusercontent.com",callback:w}),google.accounts.id.renderButton(document.getElementById("auth-google-login-btn"),{theme:"outline",size:"large"})}function k(){sessionStorage.removeItem("refreshToken"),sessionStorage.removeItem("refreshTokenExpiry"),sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("accessTokenExpiry"),e=null,o=null,t=null,n=null,function(){const e=new CustomEvent("logged-out");document.dispatchEvent(e)}(),i()}function y(){google.accounts.id.prompt()}async function I(e,o){return await f(),o&&o.headers?o.headers.Authorization||o.headers.append("Authorization",l()):o={...o,headers:new Headers({Authorization:l()})},fetch(e,o)}function S(){m()>Math.floor(Date.now()/1e3)?(p(l()),r()):(i(),y())}window.onload=()=>{var e,o;T(),window.auth={logout:k,showOneTap:y,fetchAuth:I,configureGoogleAccount:T,refreshAccessTokenIfNeeded:f,render:S,userInfo:null},e=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style"),e.appendChild(o),o.appendChild(document.createTextNode(".auth-hide { display: none; }")),S()}})();