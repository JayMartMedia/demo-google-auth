(()=>{let e,o,t,n;const s="http://localhost:4401";function a(e){const o=e.split("."),t=atob(o[1]);return JSON.parse(t)}function i(){u("auth-show-logged-in"),c("auth-show-logged-out")}function r(){c("auth-show-logged-in"),u("auth-show-logged-out")}function c(e){for(elem of document.getElementsByClassName(e))elem.classList.add("auth-hide")}function u(e){for(elem of document.getElementsByClassName(e))elem.classList.remove("auth-hide")}function d(){return t||sessionStorage.getItem("accessToken")}function l(e){t=e,sessionStorage.setItem("accessToken",e);const{exp:o}=a(e);n=o,sessionStorage.setItem("accessTokenExpiry",o)}function h(){return e||sessionStorage.getItem("refreshToken")}function m(t){e=t,sessionStorage.setItem("refreshToken",t);const{exp:n}=a(t);o=n,sessionStorage.setItem("refreshTokenExpiry",n)}async function g(){h()&&(n||sessionStorage.getItem("accessTokenExpiry"))<Math.floor(Date.now()/1e3)&&await async function(){const e=await fetch(`${s}/refresh`,{method:"POST",body:JSON.stringify({refreshToken:h()}),headers:new Headers({"Content-Type":"application/json"})}),{accessToken:o,refreshToken:t}=await e.json();m(t),l(o)}()}function f(e){const o=a(e),t={userId:o.userId,email:o.email,name:o.name,picture:o.picture},n=new CustomEvent("logged-in",{detail:{userInfo:t}});document.dispatchEvent(n)}async function p(e){const o=e.credential,t=await fetch(`${s}/token`,{method:"POST",body:JSON.stringify({googleJwt:o}),headers:new Headers({"Content-Type":"application/json"})}),{accessToken:n,refreshToken:r}=await t.json();m(r),l(n),f(n),i();const{userId:c,picture:u,name:d,email:h}=a(n);var g;g={userId:c,picture:u,name:d,email:h},window.auth.userInfo=g}function w(){google.accounts.id.initialize({client_id:"403706356522-9l5kmo3oujjk8ho182ec3kts8k96d935.apps.googleusercontent.com",callback:p}),google.accounts.id.renderButton(document.getElementById("auth-google-login-btn"),{theme:"outline",size:"large"})}function T(){sessionStorage.removeItem("refreshToken"),sessionStorage.removeItem("refreshTokenExpiry"),sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("accessTokenExpiry"),e=null,o=null,t=null,n=null,function(){const e=new CustomEvent("logged-out");document.dispatchEvent(e)}(),r()}function k(){google.accounts.id.prompt()}async function y(e,o){return await g(),o&&o.headers?o.headers.Authorization||o.headers.append("Authorization",d()):o={...o,headers:new Headers({Authorization:d()})},fetch(e,o)}function I(){(o||sessionStorage.getItem("refreshTokenExpiry"))>Math.floor(Date.now()/1e3)?(f(d()),i()):(r(),k())}window.onload=()=>{var e,o;w(),window.auth={logout:T,showOneTap:k,fetchAuth:y,configureGoogleAccount:w,refreshAccessTokenIfNeeded:g,render:I,userInfo:null},e=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style"),e.appendChild(o),o.appendChild(document.createTextNode(".auth-hide { display: none; }")),I()}})();